<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products â€” Reschevie Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/main.css">
</head>
<body>
<div class="admin-layout">
  <aside class="admin-sidebar">
    <div class="admin-sidebar-logo">
      <a href="../index.html" class="logo"><span class="logo-r">R</span>eschevie</a>
      <span>Admin Panel</span>
    </div>
    <nav class="admin-nav">
      <a href="index.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ“Š</span> Dashboard</a>
      <a href="products.html" class="admin-nav-item active"><span class="admin-nav-icon">ğŸ’</span> Products</a>
      <a href="inquiries.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ“©</span> Inquiries</a>
      <a href="users.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ‘¤</span> Users</a>
      <a href="stories.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ’¬</span> Client Stories</a>
      <a href="newsletters.html" class="admin-nav-item"><span class="admin-nav-icon">âœ‰ï¸</span> Newsletters</a>
      <div style="height:1px; background:rgba(197,160,112,0.1); margin:16px 0;"></div>
      <a href="../index.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸŒ</span> View Site</a>
      <a href="#" class="admin-nav-item" id="logout-btn"><span class="admin-nav-icon">ğŸšª</span> Sign Out</a>
    </nav>
  </aside>

  <main class="admin-main">
    <div class="admin-header">
      <h1>Products</h1>
      <button class="btn-gold" id="add-product-btn">+ Add Product</button>
    </div>

    <!-- Search -->
    <div style="margin-bottom:20px;">
      <div class="search-bar">
        <input type="text" class="search-input" id="product-search" placeholder="Search products...">
        <button class="search-btn">ğŸ”</button>
      </div>
    </div>

    <div class="admin-table-wrap">
      <div class="admin-table-header">
        <h3>All Products <span id="product-count" style="font-size:14px; color:var(--gray-light); font-family:var(--font-sans);"></span></h3>
      </div>
      <table>
        <thead><tr>
          <th>Product</th><th>Type</th><th>Origin</th><th>Karat</th><th>Price</th><th>Status</th><th>Actions</th>
        </tr></thead>
        <tbody id="products-table"></tbody>
      </table>
    </div>
  </main>
</div>

<!-- Product Form Modal -->
<div class="admin-modal-overlay" id="product-form-modal">
  <div class="admin-modal">
    <button class="modal-close" id="modal-close-btn">âœ•</button>
    <h2 id="modal-title">Add Product</h2>
    <input type="hidden" id="edit-id">
    <div class="form-group">
      <label class="form-label">Product Name *</label>
      <input type="text" id="p-name" class="form-input" placeholder="e.g. Serpent BohÃ¨me Necklace">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Type *</label>
        <select id="p-type" class="form-input">
          <option value="ring">Ring</option>
          <option value="necklace">Necklace</option>
          <option value="earring">Earring</option>
          <option value="bracelet">Bracelet</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Origin *</label>
        <select id="p-origin" class="form-input">
          <option value="Japan">Japan</option>
          <option value="Italy">Italy</option>
          <option value="Saudi Arabia">Saudi Arabia</option>
          <option value="Hong Kong">Hong Kong</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Karat</label>
        <input type="text" id="p-karat" class="form-input" placeholder="e.g. 18K">
      </div>
      <div class="form-group">
        <label class="form-label">Weight</label>
        <input type="text" id="p-weight" class="form-input" placeholder="e.g. 12.4g">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Materials</label>
      <input type="text" id="p-materials" class="form-input" placeholder="e.g. 18K Yellow Gold, VS1 Diamond">
    </div>
    <div class="form-group">
      <label class="form-label">Price (use "POA" for Price Upon Request)</label>
      <input type="text" id="p-price" class="form-input" placeholder="e.g. â‚± 85,000 or POA">
    </div>
    <div class="form-group">
      <label class="form-label">Description</label>
      <textarea id="p-description" class="form-input" rows="3" placeholder="Product description..."></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">Emoji Icon</label>
      <input type="text" id="p-emoji" class="form-input" placeholder="e.g. ğŸ’">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Status</label>
        <select id="p-status" class="form-input">
          <option value="available">Available</option>
          <option value="sold">Sold</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Featured</label>
        <select id="p-featured" class="form-input">
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>
      </div>
    </div>
    <div id="form-err" class="form-error" style="display:none;margin-bottom:12px;"></div>
    <button class="btn-gold" style="width:100%; margin-top:8px;" id="save-product-btn">Save Product</button>
  </div>
</div>

<script src="../js/data.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const session = getSession();
  if (!session || session.role !== 'admin') { window.location.href = '../login.html'; return; }
  document.getElementById('logout-btn').addEventListener('click', (e) => { e.preventDefault(); clearSession(); window.location.href = '../login.html'; });

  renderTable();

  document.getElementById('add-product-btn').addEventListener('click', openAddModal);
  document.getElementById('modal-close-btn').addEventListener('click', closeModal);
  document.getElementById('product-form-modal').addEventListener('click', (e) => { if (e.target === document.getElementById('product-form-modal')) closeModal(); });
  document.getElementById('save-product-btn').addEventListener('click', saveProduct);
  document.getElementById('product-search').addEventListener('input', renderTable);
});

function renderTable() {
  const query = document.getElementById('product-search')?.value.toLowerCase() || '';
  let products = getProducts();
  if (query) products = products.filter(p => p.name.toLowerCase().includes(query) || p.origin.toLowerCase().includes(query) || p.type.toLowerCase().includes(query));
  document.getElementById('product-count').textContent = `(${products.length})`;
  document.getElementById('products-table').innerHTML = products.length
    ? products.map(p => `<tr>
        <td><strong style="color:var(--white);">${p.emoji} ${p.name}</strong></td>
        <td style="text-transform:capitalize;">${p.type}</td>
        <td>${p.origin}</td>
        <td>${p.karat}</td>
        <td>${p.price}</td>
        <td><span class="badge-status badge-${p.status}">${p.status}</span></td>
        <td>
          <button class="action-btn action-edit" onclick="openEditModal(${p.id})">Edit</button>
          <button class="action-btn action-delete" onclick="deleteProduct(${p.id})" style="margin-left:4px;">Delete</button>
        </td>
      </tr>`).join('')
    : `<tr><td colspan="7" style="text-align:center;color:var(--gray-light);padding:32px;">No products found</td></tr>`;
}

function openAddModal() {
  document.getElementById('modal-title').textContent = 'Add Product';
  document.getElementById('edit-id').value = '';
  ['p-name','p-karat','p-weight','p-materials','p-price','p-description','p-emoji'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('p-type').value = 'ring';
  document.getElementById('p-origin').value = 'Japan';
  document.getElementById('p-status').value = 'available';
  document.getElementById('p-featured').value = 'false';
  document.getElementById('form-err').style.display = 'none';
  document.getElementById('product-form-modal').classList.add('open');
}

function openEditModal(id) {
  const p = getProducts().find(x => x.id === id);
  if (!p) return;
  document.getElementById('modal-title').textContent = 'Edit Product';
  document.getElementById('edit-id').value = id;
  document.getElementById('p-name').value = p.name;
  document.getElementById('p-type').value = p.type;
  document.getElementById('p-origin').value = p.origin;
  document.getElementById('p-karat').value = p.karat;
  document.getElementById('p-weight').value = p.weight;
  document.getElementById('p-materials').value = p.materials;
  document.getElementById('p-price').value = p.price;
  document.getElementById('p-description').value = p.description;
  document.getElementById('p-emoji').value = p.emoji;
  document.getElementById('p-status').value = p.status;
  document.getElementById('p-featured').value = p.featured ? 'true' : 'false';
  document.getElementById('form-err').style.display = 'none';
  document.getElementById('product-form-modal').classList.add('open');
}

function closeModal() { document.getElementById('product-form-modal').classList.remove('open'); }

function saveProduct() {
  const errEl = document.getElementById('form-err');
  const name = document.getElementById('p-name').value.trim();
  if (!name) { errEl.textContent = 'Product name is required.'; errEl.style.display = 'block'; return; }
  errEl.style.display = 'none';

  const editId = document.getElementById('edit-id').value;
  const products = getProducts();
  const productData = {
    name, type: document.getElementById('p-type').value,
    origin: document.getElementById('p-origin').value,
    karat: document.getElementById('p-karat').value,
    weight: document.getElementById('p-weight').value,
    materials: document.getElementById('p-materials').value,
    price: document.getElementById('p-price').value || 'POA',
    priceNum: 0,
    description: document.getElementById('p-description').value,
    emoji: document.getElementById('p-emoji').value || 'ğŸ’',
    status: document.getElementById('p-status').value,
    featured: document.getElementById('p-featured').value === 'true'
  };

  if (editId) {
    const idx = products.findIndex(p => p.id == editId);
    if (idx > -1) products[idx] = { ...products[idx], ...productData };
  } else {
    productData.id = Date.now();
    products.push(productData);
  }
  saveProducts(products);
  closeModal();
  renderTable();
  showToast(editId ? 'Product updated!' : 'Product added!');
}

function deleteProduct(id) {
  if (!confirm('Are you sure you want to delete this product?')) return;
  const products = getProducts().filter(p => p.id !== id);
  saveProducts(products);
  renderTable();
  showToast('Product deleted.');
}
</script>
</body>
</html>
