<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inquiries â€” Reschevie Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/main.css">
</head>
<body>
<div class="admin-layout">
  <aside class="admin-sidebar">
    <div class="admin-sidebar-logo">
      <a href="../index.html" class="logo"><span class="logo-r">R</span>eschevie</a>
      <span>Admin Panel</span>
    </div>
    <nav class="admin-nav">
      <a href="index.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ“Š</span> Dashboard</a>
      <a href="products.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ’</span> Products</a>
      <a href="inquiries.html" class="admin-nav-item active"><span class="admin-nav-icon">ğŸ“©</span> Inquiries</a>
      <a href="users.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ‘¤</span> Users</a>
      <a href="stories.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸ’¬</span> Client Stories</a>
      <a href="newsletters.html" class="admin-nav-item"><span class="admin-nav-icon">âœ‰ï¸</span> Newsletters</a>
      <div style="height:1px; background:rgba(197,160,112,0.1); margin:16px 0;"></div>
      <a href="../index.html" class="admin-nav-item"><span class="admin-nav-icon">ğŸŒ</span> View Site</a>
      <a href="#" class="admin-nav-item" id="logout-btn"><span class="admin-nav-icon">ğŸšª</span> Sign Out</a>
    </nav>
  </aside>

  <main class="admin-main">
    <div class="admin-header">
      <h1>Inquiries</h1>
    </div>

    <div class="admin-table-wrap">
      <div class="admin-table-header">
        <h3>All Inquiries <span id="inq-count" style="font-size:14px;color:var(--gray-light);font-family:var(--font-sans);"></span></h3>
      </div>
      <table>
        <thead><tr>
          <th>Name</th><th>Email</th><th>Phone</th><th>Items</th><th>Notes</th><th>Submitted</th><th>Status</th><th>Actions</th>
        </tr></thead>
        <tbody id="inq-table"></tbody>
      </table>
    </div>
  </main>
</div>

<!-- Detail Modal -->
<div class="admin-modal-overlay" id="inq-modal">
  <div class="admin-modal" style="max-width:680px;">
    <button class="modal-close" onclick="document.getElementById('inq-modal').classList.remove('open')">âœ•</button>
    <h2>Inquiry Detail</h2>
    <div id="inq-detail"></div>
  </div>
</div>

<script src="../js/data.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const session = getSession();
  if (!session || session.role !== 'admin') { window.location.href = '../login.html'; return; }
  document.getElementById('logout-btn').addEventListener('click', (e) => { e.preventDefault(); clearSession(); window.location.href = '../login.html'; });
  renderTable();
});

function renderTable() {
  const inquiries = getInquiries().reverse();
  document.getElementById('inq-count').textContent = `(${inquiries.length})`;
  document.getElementById('inq-table').innerHTML = inquiries.length
    ? inquiries.map(i => `<tr>
        <td><strong style="color:var(--white);">${i.fname} ${i.lname}</strong></td>
        <td>${i.email}</td>
        <td>${i.phone || 'â€”'}</td>
        <td>${i.items?.length || 0} item(s)</td>
        <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${i.notes || 'â€”'}</td>
        <td>${formatDate(i.submitted_at)}</td>
        <td>
          <select onchange="updateStatus(${i.id}, this.value)" class="form-input" style="padding:4px 8px; font-size:11px; width:auto;">
            <option value="pending" ${i.status==='pending'?'selected':''}>Pending</option>
            <option value="in-progress" ${i.status==='in-progress'?'selected':''}>In Progress</option>
            <option value="completed" ${i.status==='completed'?'selected':''}>Completed</option>
          </select>
        </td>
        <td>
          <button class="action-btn action-edit" onclick="viewDetail(${i.id})">View</button>
          <button class="action-btn action-delete" onclick="deleteInquiry(${i.id})" style="margin-left:4px;">Delete</button>
        </td>
      </tr>`).join('')
    : `<tr><td colspan="8" style="text-align:center;color:var(--gray-light);padding:32px;">No inquiries yet</td></tr>`;
}

function updateStatus(id, status) {
  const inquiries = getInquiries();
  const idx = inquiries.findIndex(i => i.id === id);
  if (idx > -1) { inquiries[idx].status = status; saveInquiries(inquiries); }
}

function deleteInquiry(id) {
  if (!confirm('Delete this inquiry?')) return;
  saveInquiries(getInquiries().filter(i => i.id !== id));
  renderTable();
}

function viewDetail(id) {
  const i = getInquiries().find(x => x.id === id);
  if (!i) return;
  const products = getProducts();
  const items = (i.items || []).map(pid => products.find(p => p.id === pid)).filter(Boolean);
  document.getElementById('inq-detail').innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
      <div><label class="form-label">Name</label><p>${i.fname} ${i.lname}</p></div>
      <div><label class="form-label">Email</label><p>${i.email}</p></div>
      <div><label class="form-label">Phone</label><p>${i.phone||'Not provided'}</p></div>
      <div><label class="form-label">Preferred Contact</label><p style="text-transform:capitalize;">${i.contactPref||'â€”'}</p></div>
      <div><label class="form-label">Submitted</label><p>${formatDate(i.submitted_at)}</p></div>
      <div><label class="form-label">Status</label><p style="text-transform:capitalize;">${i.status}</p></div>
    </div>
    ${i.notes ? `<div style="margin-bottom:20px;"><label class="form-label">Special Requests</label><p style="font-size:13px;color:var(--white-dim);">${i.notes}</p></div>` : ''}
    <label class="form-label">Inquiry Items (${items.length})</label>
    ${items.map(p => `<div class="inquiry-item" style="margin-top:8px;padding:16px;background:var(--dark-3);">
      <div style="font-size:24px;">${p.emoji}</div>
      <div><div style="font-weight:600;color:var(--white);">${p.name}</div><div style="font-size:12px;color:var(--gray-light);">${p.type} Â· ${p.origin} Â· ${p.price}</div></div>
    </div>`).join('') || '<p style="color:var(--gray-light);font-size:13px;">No items</p>'}
  `;
  document.getElementById('inq-modal').classList.add('open');
}
</script>
</body>
</html>
